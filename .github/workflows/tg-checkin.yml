name: TG å¤šé¢‘é“è‡ªåŠ¨ç­¾åˆ°

on:
  workflow_dispatch:
    inputs:
      target_script:
        description: 'é€‰æ‹©è¦è¿è¡Œçš„è„šæœ¬'
        required: true
        default: 'All'
        type: choice
        options:
          - All
          #- CloudCat
          - SheerID
          - ICMP9
  schedule:
    - cron: '10 0 * * *'

jobs:
  multi_checkin:
    runs-on: ubuntu-latest
    
    env:
      TG_API_ID: ${{ secrets.TG_API_ID }}
      TG_API_HASH: ${{ secrets.TG_API_HASH }}
      TG_SESSION_STR: ${{ secrets.TG_SESSION_STR }}
      TG_BOT_TOKEN: ${{ secrets.TG_BOT_TOKEN }}
      TG_CHAT_ID: ${{ secrets.TG_CHAT_ID }}
      RUN_TARGET: ${{ github.event.inputs.target_script || 'All' }}

    steps:
    - name: â¬‡ï¸ æ£€å‡ºä»£ç 
      uses: actions/checkout@v4
      
    - name: ğŸ å®‰è£… Python ç¯å¢ƒ
      uses: actions/setup-python@v5
      with:
        python-version: '3.x'
        cache: 'pip'
        
    - name: ğŸ“¦ å®‰è£… Python ä¾èµ–
      run: |
        python -m pip install --upgrade pip
        pip install -r tg-checkin/requirements.txt
        
    #- name: ğŸš€ æ‰§è¡Œ CloudCat è‡ªåŠ¨ç­¾åˆ°
    #  if: env.RUN_TARGET == 'All' || env.RUN_TARGET == 'CloudCat'
    #  run: python -u tg-checkin/cloudcat.py
    #  continue-on-error: true

    #- name: â³ ç­‰å¾… (ä»…åœ¨ All æ¨¡å¼ä¸‹)
    #  if: env.RUN_TARGET == 'All'
    #  run: sleep 30

    - name: ğŸš€ æ‰§è¡Œ SheerID è‡ªåŠ¨ç­¾åˆ°
      if: env.RUN_TARGET == 'All' || env.RUN_TARGET == 'SheerID'
      run: python -u tg-checkin/sheerid.py
      continue-on-error: true

    - name: â³ ç­‰å¾… (ä»…åœ¨ All æ¨¡å¼ä¸‹)
      if: env.RUN_TARGET == 'All'
      run: sleep 30

    - name: ğŸš€ æ‰§è¡Œ ICMP9 è‡ªåŠ¨ç­¾åˆ°
      if: env.RUN_TARGET == 'All' || env.RUN_TARGET == 'ICMP9'
      run: python -u tg-checkin/icmp9.py
